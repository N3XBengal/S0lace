<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>S0LACE • Media</title>

  <link rel="shortcut icon" href="favicon.ico" />
  <link rel="stylesheet" href="index.css" />

  <script src="global-hub.js" defer></script>
  <script src="register-sw.js" defer></script>
</head>

<body>

<!-- SIDE ICON NAV -->
<nav class="side-header">
  <a href="index.html" class="side-icon" data-icon="home"><img /></a>
  <a href="games.html" class="side-icon" data-icon="games"><img /></a>
  <a href="media.html" class="side-icon" data-icon="media"><img /></a>
  <a href="settings.html" class="side-icon" data-icon="settings"><img /></a>
</nav>

<main>

  <!-- PAGE HEADER -->
  <div class="page-header">
    <h1>MEDIA</h1>
  </div>

  <!-- SEARCH -->
  <div class="games-search-wrap">
    <span class="search-label">SEARCH &gt;</span>
    <input
      id="media-search"
      type="text"
      placeholder="type a title and press Enter…"
      autocomplete="off"
    />
  </div>

  <!-- MOVIES -->
  <section class="media-section">
    <h2 class="media-section-title">POPULAR MOVIES</h2>
    <div class="media-grid" id="movies-grid"></div>
    <div id="media-empty-movies" class="media-empty">
      No movies found.
    </div>
  </section>

  <hr class="media-divider" />

  <!-- TV -->
  <section class="media-section">
    <h2 class="media-section-title">POPULAR SHOWS</h2>
    <div class="media-grid" id="tv-grid"></div>
    <div id="media-empty-tv" class="media-empty">
      No shows found.
    </div>
  </section>

</main>

<!-- ================= TMDB LOGIC ================= -->
<script>
const TMDB_KEY = "2d1351cf74f73892042699d0431b799a";
const IMG_BASE = "https://image.tmdb.org/t/p/";
const IMG_SIZE = "w600_and_h900_face";

const mediaSearch = document.getElementById("media-search");
const moviesGrid = document.getElementById("movies-grid");
const tvGrid = document.getElementById("tv-grid");
const moviesEmpty = document.getElementById("media-empty-movies");
const tvEmpty = document.getElementById("media-empty-tv");

function poster(path, title) {
  const img = document.createElement("img");
  img.alt = title;
  img.src = path ? IMG_BASE + IMG_SIZE + path : "thumbs/placeholder-poster.png";
  return img;
}

function movieCard(m) {
  const a = document.createElement("a");
  a.className = "media-card movie-card";
  a.href = "#";

  const thumb = document.createElement("div");
  thumb.className = "poster-thumb";

  const overlay = document.createElement("div");
  overlay.className = "media-overlay";
  overlay.textContent = m.title || "Untitled";

  thumb.append(poster(m.poster_path, m.title), overlay);
  a.appendChild(thumb);

  a.onclick = e => {
    e.preventDefault();
    location.href =
      "mediaplayer.html?src=" +
      encodeURIComponent("/scramjet/https://vidfast.pro/movie/" + m.id) +
      "&title=" +
      encodeURIComponent(m.title);
  };

  return a;
}

function tvCard(s) {
  const a = document.createElement("a");
  a.className = "media-card tv-card";
  a.href = "#";

  const thumb = document.createElement("div");
  thumb.className = "poster-thumb";

  const overlay = document.createElement("div");
  overlay.className = "media-overlay";
  overlay.textContent = s.name || "Untitled";

  thumb.append(poster(s.poster_path, s.name), overlay);
  a.appendChild(thumb);

  a.onclick = e => {
    e.preventDefault();
    location.href =
      "tvplayer.html?id=" +
      s.id +
      "&title=" +
      encodeURIComponent(s.name) +
      "&season=1&episode=1";
  };

  return a;
}

async function loadTrending(type, grid, emptyEl) {
  try {
    const r = await fetch(
      `https://api.themoviedb.org/3/trending/${type}/day?api_key=${TMDB_KEY}`
    );
    const d = await r.json();
    grid.innerHTML = "";
    emptyEl.style.display = "none";

    d.results.slice(0, 24).forEach(item => {
      grid.appendChild(type === "movie" ? movieCard(item) : tvCard(item));
    });
  } catch {
    emptyEl.style.display = "block";
  }
}

async function search(type, q, grid, emptyEl) {
  if (!q) return loadTrending(type, grid, emptyEl);

  try {
    const r = await fetch(
      `https://api.themoviedb.org/3/search/${type}?api_key=${TMDB_KEY}&query=${encodeURIComponent(q)}`
    );
    const d = await r.json();
    grid.innerHTML = "";

    if (!d.results.length) {
      emptyEl.style.display = "block";
      return;
    }

    emptyEl.style.display = "none";
    d.results.slice(0, 30).forEach(item => {
      grid.appendChild(type === "movie" ? movieCard(item) : tvCard(item));
    });
  } catch {
    emptyEl.style.display = "block";
  }
}

document.addEventListener("DOMContentLoaded", () => {
  loadTrending("movie", moviesGrid, moviesEmpty);
  loadTrending("tv", tvGrid, tvEmpty);

  mediaSearch.addEventListener("keydown", e => {
    if (e.key === "Enter") {
      const q = mediaSearch.value.trim();
      search("movie", q, moviesGrid, moviesEmpty);
      search("tv", q, tvGrid, tvEmpty);
    }
  });
});
</script>

<!-- SIDE ICON SYNC -->
<script>
function getAccent() {
  return localStorage.getItem("s0laceAccent") || "gray";
}

function updateSideIcons() {
  const accent = getAccent();
  document.querySelectorAll(".side-icon").forEach(link => {
    const icon = link.dataset.icon;
    const img = link.querySelector("img");
    const active = location.pathname.endsWith(link.getAttribute("href"));
    link.classList.toggle("active", active);
    img.src = `thumbs/${icon}/${active ? accent : "gray"}.png`;
  });
}

updateSideIcons();
window.addEventListener("storage", updateSideIcons);
</script>

</body>
</html>
